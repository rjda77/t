var e,s,t,a=Object.defineProperty,r=e=>{throw TypeError(e)},n=(e,s,t)=>((e,s,t)=>s in e?a(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t)(e,"symbol"!=typeof s?s+"":s,t),l=(e,s,t)=>s.has(e)||r("Cannot "+t),i=(e,s,t)=>(l(e,s,"read from private field"),t?t.call(e):s.get(e)),o=(e,s,t)=>s.has(e)?r("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(e):s.set(e,t),c=(e,s,t,a)=>(l(e,s,"write to private field"),a?a.call(e,t):s.set(e,t),t),d=(e,s,t,a)=>({set _(a){c(e,s,a,t)},get _(){return i(e,s,a)}});import{n as u,o as h,r as p,j as m,g as f,c as x,p as g,q as v,s as y,t as j,v as b,C as w,w as N,x as C,y as k,z as F,A as S,B as I,_ as T,D as P,E as M,F as z,G as O,H as L,I as D,k as A,J as B,K as q,M as E,N as U,O as $,P as _,l as R}from"./index-DylG8tB4.js";import{u as K,a as W,b as V,m as H,c as Z,C as G,F as Q,d as Y,e as J,f as X,g as ee,h as se,i as te,j as ae,k as re,l as ne,n as le,o as ie,p as oe,q as ce,r as de,P as ue}from"./Preview-BTgl7gbC.js";var he=u(((e,s)=>{const{as:t,children:a,className:r,...n}=e,{slots:l,classNames:i,bodyId:o,setBodyMounted:c}=K(),d=h(s),u=t||"div";return p.useEffect((()=>(c(!0),()=>c(!1))),[c]),m.jsx(u,{ref:d,className:l.body({class:f(null==i?void 0:i.body,r)}),id:o,...n,children:a})}));he.displayName="TwMaterial.ModalBody";var pe=he,me=u(((e,s)=>{const{as:t,children:a,className:r,...n}=e,{slots:l,classNames:i}=K(),o=h(s),c=t||"footer";return m.jsx(c,{ref:o,className:l.footer({class:f(null==i?void 0:i.footer,r)}),...n,children:a})}));me.displayName="TwMaterial.ModalFooter";var fe=me,xe=u(((e,s)=>{const{as:t,children:a,className:r,...n}=e,{slots:l,classNames:i,headerId:o,setHeaderMounted:c}=K(),d=h(s),u=t||"header";return p.useEffect((()=>(c(!0),()=>c(!1))),[c]),m.jsx(u,{ref:d,className:l.header({class:f(null==i?void 0:i.header,r)}),id:o,...n,children:a})}));xe.displayName="TwMaterial.ModalHeader";var ge=xe;const ve=e=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",...e,children:m.jsx("path",{fill:"currentColor",d:"M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z"})}),ye=e=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",...e,children:m.jsxs("g",{fill:"none",fillRule:"evenodd",children:[m.jsx("path",{d:"m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"}),m.jsx("path",{fill:"currentColor",d:"M9 2a2 2 0 0 0-2 2v2h2V4h11v11h-2v2h2a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zM4 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zm0 2h11v11H4z"})]})}),je=({value:e,...s})=>{const{copy:t,copied:a}=function({timeout:e=2e3}={}){const[s,t]=p.useState(null),[a,r]=p.useState(!1),[n,l]=p.useState(null),i=p.useCallback((()=>{n&&clearTimeout(n)}),[n]),o=p.useCallback((s=>{i(),l(setTimeout((()=>r(!1)),e)),r(s)}),[i,e]);return{copy:p.useCallback((e=>{"clipboard"in navigator?navigator.clipboard.writeText(e).then((()=>o(!0))).catch((e=>t(e))):t(new Error("useClipboard: navigator.clipboard is not supported"))}),[o]),reset:p.useCallback((()=>{r(!1),t(null),i()}),[i]),error:s,copied:a}}();return m.jsxs(x,{isIconOnly:!0,className:"z-50 border-1 before:content-[''] before:block before:z-[-1] before:absolute before:inset-0",variant:"filledTonal",onPress:()=>{t(e)},disableRipple:!0,...s,children:[m.jsx(ve,{className:"absolute size-6 opacity-0 scale-50  data-[visible=true]:opacity-100 data-[visible=true]:scale-100 transition-transform-opacity","data-visible":a}),m.jsx(ye,{className:"absolute size-6 opacity-0 scale-50 data-[visible=true]:opacity-100 data-[visible=true]:scale-100 transition-transform-opacity","data-visible":!a})]})},be=e=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",...e,children:m.jsx("path",{fill:"currentColor",d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"})}),we=p.memo((({queryKey:e,handleClose:s})=>{const t=g.update(e),{currentFile:a,actions:r}=W(V((e=>({currentFile:e.currentFile,actions:e.actions})))),n=p.useCallback((()=>{t.mutate({id:null==a?void 0:a.id,payload:{name:null==a?void 0:a.name,type:null==a?void 0:a.type}}),s()}),[a.name,a.id]);return m.jsxs(m.Fragment,{children:[m.jsx(ge,{className:"flex flex-col gap-1",children:"Rename"}),m.jsx(pe,{children:m.jsx(v,{size:"lg",variant:"bordered",classNames:{inputWrapper:"border-primary border-large"},autoFocus:!0,value:a.name,onValueChange:e=>r.setCurrentFile({...a,name:e})})}),m.jsxs(fe,{children:[m.jsx(x,{className:"font-normal",variant:"text",onPress:s,children:"Close"}),m.jsx(x,{className:"font-normal",variant:"filledTonal",onPress:n,children:"Rename"})]})]})})),Ne=p.memo((({queryKey:e,handleClose:s})=>{const t=g.create(e),{currentFile:a,actions:r}=W(V((e=>({currentFile:e.currentFile,actions:e.actions})))),n=p.useCallback((()=>{t.mutateAsync({name:a.name,type:"folder",path:e[1].path||"/"}).then((()=>s()))}),[a.name]);return m.jsxs(m.Fragment,{children:[m.jsx(ge,{className:"flex flex-col gap-1",children:"Create Folder"}),m.jsx(pe,{children:m.jsx(v,{size:"lg",variant:"bordered",classNames:{inputWrapper:"border-primary border-large"},autoFocus:!0,value:null==a?void 0:a.name,onValueChange:e=>r.setCurrentFile({...a,name:e})})}),m.jsxs(fe,{children:[m.jsx(x,{className:"font-normal",variant:"text",onPress:s,children:"Close"}),m.jsx(x,{className:"font-normal",variant:"filledTonal",onPress:n,isDisabled:t.isPending||!a.name,isLoading:t.isPending,children:t.isPending?"Creating":"Create"})]})]})})),Ce=p.memo((({handleClose:e,queryKey:s})=>{const t=g.delete(s),a=W((e=>e.selectedFiles)),r=p.useCallback((()=>{t.mutate({files:a}),e()}),[]);return m.jsxs(m.Fragment,{children:[m.jsx(ge,{className:"flex flex-col gap-1",children:"Delete Files"}),m.jsx(pe,{children:m.jsx("h1",{className:"text-large font-medium mt-2",children:`Are you sure to delete ${a.length} file${a.length>1?"s":""} ?`})}),m.jsxs(fe,{children:[m.jsx(x,{className:"font-normal",variant:"text",onPress:e,children:"No"}),m.jsx(x,{variant:"filledTonal",classNames:{base:"font-normal"},onPress:r,children:"Yes"})]})]})})),ke={expirationDate:"",password:""},Fe=p.memo((({handleClose:e})=>{const s=W((e=>e.currentFile)),t=y.shareByFileId(null==s?void 0:s.id),{data:a,isLoading:r}=j(t),{control:n,handleSubmit:l}=b({defaultValues:ke}),i=y.create(s.id,t.queryKey),o=y.delete(s.id,t.queryKey),[c,d]=p.useState(!1),[u,h]=p.useState(""),f=p.useCallback((()=>{d((e=>(e||l((e=>{const s={};e.expirationDate&&(s.expirationDate=`${e.expirationDate}T00:00:00.000Z`),e.password&&(s.password=e.password),i.mutateAsync(s)}))(),e&&(o.mutateAsync(),h("")),!e)))}),[]);return p.useEffect((()=>{a&&(d(!0),h(`${window.location.origin}/share/${a.id}`))}),[a]),m.jsxs(m.Fragment,{children:[m.jsxs(ge,{className:"flex items-center justify-between ",children:["Share Files",m.jsx(x,{size:"sm",variant:"text",isIconOnly:!0,onPress:e,children:m.jsx(be,{})})]}),m.jsxs(pe,{children:[m.jsxs("form",{className:"grid grid-cols-6 gap-8 p-2 w-full overflow-y-auto",children:[m.jsxs("div",{className:"col-span-6 xs:col-span-3",children:[m.jsx("p",{className:"text-lg font-medium",children:"Set expiration date"}),m.jsx("p",{className:"text-sm font-normal text-on-surface-variant",children:"Link expiration date"})]}),m.jsx(w,{name:"expirationDate",control:n,render:({field:e,fieldState:{error:s}})=>m.jsx(v,{size:"lg",className:"col-span-6 xs:col-span-3",variant:"bordered",isInvalid:!!s,errorMessage:null==s?void 0:s.message,type:"date",min:N(),...e})}),m.jsxs("div",{className:"col-span-6 xs:col-span-3",children:[m.jsx("p",{className:"text-lg font-medium",children:"Set link password"}),m.jsx("p",{className:"text-sm font-normal text-on-surface-variant",children:"Public link password"})]}),m.jsx(w,{name:"password",control:n,render:({field:e,fieldState:{error:s}})=>m.jsx(v,{size:"lg",className:"col-span-6 xs:col-span-3",variant:"bordered",isInvalid:!!s,errorMessage:null==s?void 0:s.message,type:"password",...e})})]}),m.jsx(C,{}),m.jsxs("div",{className:"flex justify-between",children:[m.jsxs("h1",{className:"text-large font-medium mt-2",children:["Sharing ",c?"On":"Off"]}),m.jsx(k,{size:"md",isSelected:c,onChange:f})]})]}),m.jsxs(fe,{children:[m.jsx(v,{isDisabled:r||!a,fullWidth:!0,variant:"bordered",readOnly:!0,value:u}),m.jsx(je,{value:u,isDisabled:r||!a})]})]})})),Se=p.memo((({queryKey:e})=>{const{open:s,operation:t,actions:a}=W(V((e=>({open:e.open,operation:e.operation,actions:e.actions})))),r=p.useCallback((()=>a.set({open:!1})),[]);return m.jsx(H,{isOpen:s,size:"md",classNames:{wrapper:"overflow-hidden",base:"bg-surface w-full shadow-none"},placement:"center",onClose:r,hideCloseButton:!0,children:m.jsx(Z,{children:()=>{switch(t){case Q.RenameFile.id:return m.jsx(we,{queryKey:e,handleClose:r});case Q.CreateFolder.id:return m.jsx(Ne,{queryKey:e,handleClose:r});case Q.DeleteFiles.id:return m.jsx(Ce,{queryKey:e,handleClose:r});case G.ShareFiles.id:return m.jsx(Fe,{handleClose:r});default:return null}}})})})),Ie=e=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",...e,children:m.jsx("path",{fill:"currentColor",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8m4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4l8-8z"})}),Te=e=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",...e,children:m.jsx("path",{fill:"currentColor",d:"M12 7c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1s-1-.45-1-1V8c0-.55.45-1 1-1m-.01-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8s8 3.58 8 8s-3.58 8-8 8m1-3h-2v-2h2z"})}),Pe=e=>m.jsx("svg",{viewBox:"0 0 48 48",width:"1.5rem",height:"1.5rem",...e,children:m.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:4,children:[m.jsx("path",{d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4S4 12.954 4 24s8.954 20 20 20Z"}),m.jsx("path",{strokeLinecap:"round",d:"M29.657 18.343L18.343 29.657m0-11.314l11.314 11.314"})]})}),Me=e=>m.jsx("svg",{viewBox:"0 0 48 48",width:"1.5rem",height:"1.5rem",...e,children:m.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:4,children:[m.jsx("path",{d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4S4 12.954 4 24s8.954 20 20 20Z"}),m.jsx("path",{strokeLinecap:"round",d:"m33 21l-9 9l-9-9"})]})}),ze=e=>m.jsxs("svg",{viewBox:"0 0 48 48",width:"1.5rem",height:"1.5rem",...e,children:[m.jsx("defs",{children:m.jsx("path",{id:"ipOUpC0",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4S4 12.954 4 24s8.954 20 20 20"})}),m.jsxs("g",{fill:"none",stroke:"currentColor",strokeWidth:4,children:[m.jsx("use",{href:"#ipOUpC0",clipRule:"evenodd"}),m.jsx("use",{href:"#ipOUpC0",strokeLinejoin:"round"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m33 27l-9-9l-9 9"})]})]}),Oe=e=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",...e,children:m.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,children:[m.jsx("path",{strokeDasharray:64,strokeDashoffset:64,d:"M5.64 5.64c3.51 -3.51 9.21 -3.51 12.73 0c3.51 3.51 3.51 9.21 0 12.73c-3.51 3.51 -9.21 3.51 -12.73 0c-3.51 -3.51 -3.51 -9.21 -0 -12.73Z",children:m.jsx("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"0.6s",values:"64;0"})}),m.jsx("path",{strokeDasharray:20,strokeDashoffset:20,d:"M6 6l12 12",children:m.jsx("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.6s",dur:"0.2s",values:"20;0"})})]})});var Le,De,Ae={exports:{}},Be={exports:{}};Le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",De={rotl:function(e,s){return e<<s|e>>>32-s},rotr:function(e,s){return e<<32-s|e>>>s},endian:function(e){if(e.constructor==Number)return 16711935&De.rotl(e,8)|4278255360&De.rotl(e,24);for(var s=0;s<e.length;s++)e[s]=De.endian(e[s]);return e},randomBytes:function(e){for(var s=[];e>0;e--)s.push(Math.floor(256*Math.random()));return s},bytesToWords:function(e){for(var s=[],t=0,a=0;t<e.length;t++,a+=8)s[a>>>5]|=e[t]<<24-a%32;return s},wordsToBytes:function(e){for(var s=[],t=0;t<32*e.length;t+=8)s.push(e[t>>>5]>>>24-t%32&255);return s},bytesToHex:function(e){for(var s=[],t=0;t<e.length;t++)s.push((e[t]>>>4).toString(16)),s.push((15&e[t]).toString(16));return s.join("")},hexToBytes:function(e){for(var s=[],t=0;t<e.length;t+=2)s.push(parseInt(e.substr(t,2),16));return s},bytesToBase64:function(e){for(var s=[],t=0;t<e.length;t+=3)for(var a=e[t]<<16|e[t+1]<<8|e[t+2],r=0;r<4;r++)8*t+6*r<=8*e.length?s.push(Le.charAt(a>>>6*(3-r)&63)):s.push("=");return s.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var s=[],t=0,a=0;t<e.length;a=++t%4)0!=a&&s.push((Le.indexOf(e.charAt(t-1))&Math.pow(2,-2*a+8)-1)<<2*a|Le.indexOf(e.charAt(t))>>>6-2*a);return s}},Be.exports=De;var qe,Ee,Ue,$e,_e,Re=Be.exports,Ke={utf8:{stringToBytes:function(e){return Ke.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(Ke.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var s=[],t=0;t<e.length;t++)s.push(255&e.charCodeAt(t));return s},bytesToString:function(e){for(var s=[],t=0;t<e.length;t++)s.push(String.fromCharCode(e[t]));return s.join("")}}},We=Ke,Ve=function(e){return null!=e&&(He(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&He(e.slice(0,0))}(e)||!!e._isBuffer)};function He(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}qe=Re,Ee=We.utf8,Ue=Ve,$e=We.bin,(_e=function(e,s){e.constructor==String?e=s&&"binary"===s.encoding?$e.stringToBytes(e):Ee.stringToBytes(e):Ue(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var t=qe.bytesToWords(e),a=8*e.length,r=1732584193,n=-271733879,l=-1732584194,i=271733878,o=0;o<t.length;o++)t[o]=16711935&(t[o]<<8|t[o]>>>24)|4278255360&(t[o]<<24|t[o]>>>8);t[a>>>5]|=128<<a%32,t[14+(a+64>>>9<<4)]=a;var c=_e._ff,d=_e._gg,u=_e._hh,h=_e._ii;for(o=0;o<t.length;o+=16){var p=r,m=n,f=l,x=i;r=c(r,n,l,i,t[o+0],7,-680876936),i=c(i,r,n,l,t[o+1],12,-389564586),l=c(l,i,r,n,t[o+2],17,606105819),n=c(n,l,i,r,t[o+3],22,-1044525330),r=c(r,n,l,i,t[o+4],7,-176418897),i=c(i,r,n,l,t[o+5],12,1200080426),l=c(l,i,r,n,t[o+6],17,-1473231341),n=c(n,l,i,r,t[o+7],22,-45705983),r=c(r,n,l,i,t[o+8],7,1770035416),i=c(i,r,n,l,t[o+9],12,-1958414417),l=c(l,i,r,n,t[o+10],17,-42063),n=c(n,l,i,r,t[o+11],22,-1990404162),r=c(r,n,l,i,t[o+12],7,1804603682),i=c(i,r,n,l,t[o+13],12,-40341101),l=c(l,i,r,n,t[o+14],17,-1502002290),r=d(r,n=c(n,l,i,r,t[o+15],22,1236535329),l,i,t[o+1],5,-165796510),i=d(i,r,n,l,t[o+6],9,-1069501632),l=d(l,i,r,n,t[o+11],14,643717713),n=d(n,l,i,r,t[o+0],20,-373897302),r=d(r,n,l,i,t[o+5],5,-701558691),i=d(i,r,n,l,t[o+10],9,38016083),l=d(l,i,r,n,t[o+15],14,-660478335),n=d(n,l,i,r,t[o+4],20,-405537848),r=d(r,n,l,i,t[o+9],5,568446438),i=d(i,r,n,l,t[o+14],9,-1019803690),l=d(l,i,r,n,t[o+3],14,-187363961),n=d(n,l,i,r,t[o+8],20,1163531501),r=d(r,n,l,i,t[o+13],5,-1444681467),i=d(i,r,n,l,t[o+2],9,-51403784),l=d(l,i,r,n,t[o+7],14,1735328473),r=u(r,n=d(n,l,i,r,t[o+12],20,-1926607734),l,i,t[o+5],4,-378558),i=u(i,r,n,l,t[o+8],11,-2022574463),l=u(l,i,r,n,t[o+11],16,1839030562),n=u(n,l,i,r,t[o+14],23,-35309556),r=u(r,n,l,i,t[o+1],4,-1530992060),i=u(i,r,n,l,t[o+4],11,1272893353),l=u(l,i,r,n,t[o+7],16,-155497632),n=u(n,l,i,r,t[o+10],23,-1094730640),r=u(r,n,l,i,t[o+13],4,681279174),i=u(i,r,n,l,t[o+0],11,-358537222),l=u(l,i,r,n,t[o+3],16,-722521979),n=u(n,l,i,r,t[o+6],23,76029189),r=u(r,n,l,i,t[o+9],4,-640364487),i=u(i,r,n,l,t[o+12],11,-421815835),l=u(l,i,r,n,t[o+15],16,530742520),r=h(r,n=u(n,l,i,r,t[o+2],23,-995338651),l,i,t[o+0],6,-198630844),i=h(i,r,n,l,t[o+7],10,1126891415),l=h(l,i,r,n,t[o+14],15,-1416354905),n=h(n,l,i,r,t[o+5],21,-57434055),r=h(r,n,l,i,t[o+12],6,1700485571),i=h(i,r,n,l,t[o+3],10,-1894986606),l=h(l,i,r,n,t[o+10],15,-1051523),n=h(n,l,i,r,t[o+1],21,-2054922799),r=h(r,n,l,i,t[o+8],6,1873313359),i=h(i,r,n,l,t[o+15],10,-30611744),l=h(l,i,r,n,t[o+6],15,-1560198380),n=h(n,l,i,r,t[o+13],21,1309151649),r=h(r,n,l,i,t[o+4],6,-145523070),i=h(i,r,n,l,t[o+11],10,-1120210379),l=h(l,i,r,n,t[o+2],15,718787259),n=h(n,l,i,r,t[o+9],21,-343485551),r=r+p>>>0,n=n+m>>>0,l=l+f>>>0,i=i+x>>>0}return qe.endian([r,n,l,i])})._ff=function(e,s,t,a,r,n,l){var i=e+(s&t|~s&a)+(r>>>0)+l;return(i<<n|i>>>32-n)+s},_e._gg=function(e,s,t,a,r,n,l){var i=e+(s&a|t&~a)+(r>>>0)+l;return(i<<n|i>>>32-n)+s},_e._hh=function(e,s,t,a,r,n,l){var i=e+(s^t^a)+(r>>>0)+l;return(i<<n|i>>>32-n)+s},_e._ii=function(e,s,t,a,r,n,l){var i=e+(t^(s|~a))+(r>>>0)+l;return(i<<n|i>>>32-n)+s},_e._blocksize=16,_e._digestsize=16,Ae.exports=function(e,s){if(null==e)throw new Error("Illegal argument "+e);var t=qe.wordsToBytes(_e(e,s));return s&&s.asBytes?t:s&&s.asString?$e.bytesToString(t):qe.bytesToHex(t)};const Ze=F(Ae.exports);class Ge{constructor(e){n(this,"value"),n(this,"next"),this.value=e}}class Qe{constructor(){o(this,e),o(this,s),o(this,t),this.clear()}enqueue(a){const r=new Ge(a);i(this,e)?(i(this,s).next=r,c(this,s,r)):(c(this,e,r),c(this,s,r)),d(this,t)._++}dequeue(){const s=i(this,e);if(s)return c(this,e,i(this,e).next),d(this,t)._--,s.value}peek(){if(i(this,e))return i(this,e).value}clear(){c(this,e,void 0),c(this,s,void 0),c(this,t,0)}get size(){return i(this,t)}*[Symbol.iterator](){let s=i(this,e);for(;s;)yield s.value,s=s.next}}function Ye(e){Je(e);const s=new Qe;let t=0;const a=()=>{t<e&&s.size>0&&(s.dequeue()(),t++)},r=async(e,s,r)=>{const n=(async()=>e(...r))();s(n);try{await n}catch{}t--,a()},n=(n,...l)=>new Promise((i=>{((n,l,i)=>{new Promise((e=>{s.enqueue(e)})).then(r.bind(void 0,n,l,i)),(async()=>{await Promise.resolve(),t<e&&a()})()})(n,i,l)}));return Object.defineProperties(n,{activeCount:{get:()=>t},pendingCount:{get:()=>s.size},clearQueue:{value(){s.clear()}},concurrency:{get:()=>e,set(r){Je(r),e=r,queueMicrotask((()=>{for(;t<e&&s.size>0;)a()}))}}}),n}function Je(e){if(!Number.isInteger(e)&&e!==Number.POSITIVE_INFINITY||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up")}e=new WeakMap,s=new WeakMap,t=new WeakMap;const Xe=(e,s,t,a,r)=>new Promise(((n,l)=>{const i=new XMLHttpRequest,o=new URL(e);for(const e of Object.keys(t))o.searchParams.append(e,String(t[e]));a.addEventListener("abort",(()=>i.abort())),i.open("POST",o.href,!0),i.responseType="json",i.upload.onprogress=e=>e.lengthComputable&&r(e.loaded/e.total*100),i.onload=()=>{r(100),n(i.response)},i.onabort=()=>{l(new Error("Upload aborted"))},i.onerror=()=>{l(new Error("Upload failed"))},i.send(s)})),es=p.memo((({id:e})=>{const{status:s,progress:t,file:a}=Y((s=>s.fileMap[e])),r=Y((e=>e.actions.removeFile)),{name:n,size:l}=a,{icon:i,colorCode:o}=J({name:n,isDir:!1,id:""}),c=p.useMemo((()=>s===X.UPLOADING?`${S(t/100*l)} of ${S(l)}`:s===X.UPLOADED?`${S(l)}`:""),[t,l,s]),d=p.useCallback((()=>s===X.NOT_STARTED||s===X.UPLOADING?m.jsx(x,{onPress:()=>r(e),className:"text-inherit",variant:"text",isIconOnly:!0,children:m.jsx(be,{})}):s===X.UPLOADED?m.jsx(x,{className:"text-green-600",variant:"text",isIconOnly:!0,children:m.jsx(Ie,{})}):s===X.FAILED?m.jsx(x,{className:"text-red-600",variant:"text",isIconOnly:!0,children:m.jsx(Te,{})}):m.jsx(x,{className:"text-gray-800",variant:"text",isIconOnly:!0,children:m.jsx(Oe,{})})),[s,e,r]);return m.jsxs("div",{className:"flex size-full items-center gap-3",children:[m.jsx("div",{className:"size-8 grid rounded-lg shrink-0",style:{backgroundColor:`${ee[o]}1F`},children:m.jsx(se,{className:"size-5 text-center min-w-5 place-self-center text-primary",icon:i,style:{color:ee[o]}})}),m.jsxs("div",{className:"flex flex-col gap-2 truncate flex-1",children:[m.jsx("p",{title:n,className:"truncate text-base font-normal",children:n}),c&&m.jsxs(m.Fragment,{children:[m.jsx("div",{style:{width:`${t}%`},className:"bg-primary h-0.5 w-0 transition-[width] duration-300 ease-in"}),m.jsx("p",{className:"text-sm font-normal",children:c})]})]}),d()]})})),ss=({queryKey:e})=>{const{fileIds:s,currentFile:t,collapse:a,fileDialogOpen:r,actions:n}=Y(V((e=>({fileIds:e.filesIds,fileMap:e.fileMap,currentFile:e.fileMap[e.currentFileId],collapse:e.collapse,actions:e.actions,fileDialogOpen:e.fileDialogOpen})))),{settings:l}=I(),{data:i}=j(A.session()),o=p.useRef(null),c=p.useCallback((()=>{var e;null==(e=null==o?void 0:o.current)||e.click(),window.addEventListener("focus",(()=>n.setFileDialogOpen(!1)),{once:!0})}),[]);p.useEffect((()=>{r&&c()}),[r]);const d=p.useCallback((e=>{const s=e.target.files?Array.from(e.target.files).filter((e=>e.size>0)):[];s.length>0&&n.addFiles(s)}),[]),u=g.create(e);return p.useEffect((()=>{(null==t?void 0:t.id)&&(null==t?void 0:t.status)===X.NOT_STARTED&&(n.setFileUploadStatus(t.id,X.UPLOADING),(async(e,s,t,a,r,n,l,i,o)=>{const c=e.name;if((await O.get("/api/files",{params:{path:s,name:c,op:"find"}})).data.files.length>0)throw new Error("File already exists");const d=Math.ceil(e.size/t),u=Ye(r),h=Ze(`${s}/${c}${e.size.toString()}${L(e.lastModified)}${a}`),p=`${window.location.origin}/api/uploads/${h}`,m=(await O.get(p)).data.parts;let f=0;m.length>0&&(f=m[0].channelId);const x=[],g=[];for(let w=0;w<d;w++)m.findIndex((e=>e.partNo===w+1))>-1?g[w]=100:x.push(u((()=>(async()=>{const s=w*t,a=Math.min(w*t+t,e.size),r=d>1?e.slice(s,a):e,i={partName:d>1?`${c}.part.${D(w+1,3)}`:c,fileName:c,partNo:w+1,encrypted:n,channelId:f};return await Xe(p,r,i,l,(e=>{g[w]=e}))})())));const v=setInterval((()=>{const e=g.reduce(((e,s)=>e+s),0);i(e/d)}),1e3);l.addEventListener("abort",(()=>{u.clearQueue(),clearInterval(v)}));const y=await Promise.all(x),j=m.concat(y).sort(((e,s)=>e.partNo-s.partNo)).map((e=>({id:e.partId,salt:e.salt}))),b={name:c,mimeType:e.type??"application/octet-stream",type:"file",parts:j,size:e.size,path:s||"/",encrypted:n,channelId:f};await o(b),await O.delete(p),clearInterval(v)})(t.file,e[1].path,Number(l.splitFileSize),null==i?void 0:i.userId,Number(l.uploadConcurrency),Boolean(l.encryptFiles),t.controller.signal,(e=>n.setProgress(t.id,e)),(async e=>{await u.mutateAsync(e),u.isSuccess&&n.setFileUploadStatus(t.id,X.UPLOADED)})).then((()=>{n.setFileUploadStatus(t.id,X.UPLOADED),n.startNextUpload()})).catch((e=>{T.error(e.message)})))}),[null==t?void 0:t.id]),m.jsxs("div",{className:"fixed right-10 bottom-10",children:[m.jsx("input",{className:"opacity-0",ref:o,type:"file",multiple:!0,onChange:d}),s.length>0&&m.jsxs("div",{className:"max-w-xs",children:[m.jsxs("div",{className:f("shadow-md w-full flex items-center gap-2","px-4 py-2 text-sm font-medium bg-surface-container min-h-12",a?"rounded-lg":"rounded-t-lg"),children:[m.jsx("span",{children:"Upload"}),m.jsxs("span",{className:"text-label-medium",children:[s.length," ",s.length>1?"files":"file"]}),m.jsxs("div",{className:"inline-flex gap-2 ml-auto",children:[m.jsx(x,{variant:"text",className:"text-inherit",isIconOnly:!0,onPress:n.toggleCollapse,children:a?m.jsx(ze,{}):m.jsx(Me,{})}),m.jsx(x,{variant:"text",className:"text-inherit",isIconOnly:!0,onPress:n.cancelUpload,children:m.jsx(Pe,{})})]})]}),m.jsx(P,{"aria-label":"Upload Files",isVirtualized:s.length>100,className:f("max-w-xs rounded-none rounded-b-lg dark:bg-surface-container-lowest bg-surface shadow-md","transition-[max-height] duration-300 ease-in-out select-none",M,a?"max-h-0 overflow-hidden":"max-h-80 overflow-y-auto"),children:s.map(((e,s)=>m.jsx(z,{className:"data-[hover=true]:bg-transparent px-0",textValue:e,children:m.jsx(es,{id:e})},e)))})]})]})};let ts=!0;const as=[Q.RenameFile.id,Q.CreateFolder.id,Q.DeleteFiles.id,G.ShareFiles.id],rs=$("/_authenticated/$"),ns=new Map,ls=p.memo((()=>{const{queryParams:e}=rs.useRouteContext(),s=rs.useSearch(),t=p.useRef(null),{data:a}=j(A.session()),r=g.list(Object.keys(s).length>0?{...e,filter:s}:e,null==a?void 0:a.hash),n=W((e=>e.open)),l=W((e=>e.operation)),i=Y((e=>e.uploadOpen)),{breakpoint:o}=te(_),{data:c,fetchNextPage:d,hasNextPage:u,isFetchingNextPage:h}=ae(r),f=re(e,a),x=p.useMemo((()=>"my-drive"===e.type?B(e.path).map((([e,s],t)=>({id:t+e,name:e,path:s,isDir:!0,chain:!0}))):[]),[e.path,e.type]);return p.useEffect((()=>{if(!ts)return setTimeout((()=>{var s,a;null==(a=t.current)||a.scrollTo({top:(null==(s=ns.get(e.type+e.path))?void 0:s.scrollTop)??0,left:0})}),0),()=>{var s;t.current&&void 0!==t.current.getState&&(null==(s=t.current)||s.getState((s=>ns.set(e.type+e.path,s))))};ts=!1}),[e.path,e.type]),m.jsxs("div",{className:"size-full m-auto",children:[m.jsxs(ne,{files:c,folderChain:x,onFileAction:f(),fileActions:le,defaultFileViewActionId:q,defaultSortActionId:"my-drive"===e.type?E.sortId:U[e.type].sortId,defaultSortOrder:"my-drive"===e.type?E.order:U[e.type].order,breakpoint:o,children:["my-drive"===e.type&&m.jsx(ie,{breakpoint:o}),m.jsx(oe,{className:"my-drive"!==e.type?"pt-2":""}),m.jsx(ce,{hasNextPage:u,isNextPageLoading:h,loadNextPage:d,ref:t}),m.jsx(de,{})]}),as.find((e=>e===l))&&n&&m.jsx(Se,{queryKey:r.queryKey}),l===Q.OpenFiles.id&&n&&m.jsx(ue,{session:a,files:c,path:e.path,type:e.type}),i&&m.jsx(ss,{queryKey:r.queryKey})]})})),is=R("/_authenticated/$")({component:ls});export{is as Route};
